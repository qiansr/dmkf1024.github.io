---
title: 听说你PHP配置Composer遇到了一些困境
date: 2017-03-24 23:57:30
tags:
	- PHP
	- Propel
	- 教程
categories: PHP是世界上最好的语言
---
# 前情提要

最近在写PHP通信接口，涉及到数据库CRUD操作时，觉得PHP原生方法每次都要写SQL语句，效率不高，于是尝试使用Propel orm框架，此文记录PHP配置Propel步骤，以作备份。

PS：其实笔者看了《[PHP ORM框架Propel VS Doctrine](http://blog.csdn.net/caleng/article/details/5276500)》一文后，感觉Doctrine框架更加丰富。

# 写在配置前

配置需求：
* PHP 5.5或以上
* 可支持的数据库（MySQL, MS SQL Server, PostgreSQL, SQLite, Oracle）

配置Propel有三种途径，分别为：
* Composer管理工具
* Git指令获取
* Tar或Zip压缩包

# Composer

使用Composer指令需要先下载Composer工具，[Propel官网](http://propelorm.org/documentation/01-installation.html#via-composer)提供了方法如下，在项目根目录创建一个名为`composer.json`的文件，在文件中输入内容如下：
```
{
    "require": {
        "propel/propel": "~2.0@dev"
    }
}
```
然后使用终端（Mac、Linux）或命令行（Windows）在项目根目录下输入指令如下：
```
// 下载composer.phar
$ wget http://getcomposer.org/composer.phar
// 如果没有wget指令，可使用curl指令下载
$ curl -s http://getcomposer.org/installer | php
// 通过composer.phar安装composer
$ php composer.phar
// 下载composer依赖，其中包括propel
$ composer install
```
但是这种方法会在执行第一条指令时出现**下载中断**情况！笔者尝试翻墙，但还是下载中断，可能与笔者的网速有关，如果读者们遇到这种情况，可以尝试[Composer中国镜像](https://pkg.phpcomposer.com/#how-to-install-composer)推荐的方法来下载composer。
中国镜像推荐的方法是先下载`composer-setup.php`文件，然后执行该文件下载`composer.phar`文件，再执行`composer.phar`文件，安装Composer。这一安装过程通过执行如下指令实现：
```
$ php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
$ php composer-setup.php
$ php -r "unlink('composer-setup.php');"
```
**但是这里还是有一个坑！！！**当网速不是很给力的时候，第一条指令下载过来的`composer-setup.php`文件内容是不完整的。如下图所示，左边是不完整的文件内容，右边是完整的文件内容。
![文件内容不完整](http://upload-images.jianshu.io/upload_images/291600-738fa7f32b939cd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)
当文件内容不完整时，执行第二条指令`php composer-setup.php`，会出现类似如下错误：
![报错信息](http://upload-images.jianshu.io/upload_images/291600-614077b3bdbc771a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)
因此上述指令中的第一条指令需要换为手动在浏览器搜索栏输入网址`https://getcomposer.org/installer`下载文件，然后将文件名称更改为`composer-setup.php`，放入项目根目录，其他两条指令照常执行。
通过上述操作可得到`composer.phar`文件，这时候在项目根目录新建一个名为composer.json的文件，输入内容如下：
```
{
    "require": {
        "propel/propel": "~2.0@dev"
    }
}
```
然后在该文件中添加国内镜像，添加后的文件内容为:
```
{
    "require": {
        "propel/propel": "~2.0@dev"
    },
    "repositories": {
        "packagist": {
            "type": "composer",
            "url": "https://packagist.phpcomposer.com"
        }
    }
}
```
然后执行如下指令来安装Composer：
```
$ php composer.phar
```
安装完Composer后，执行下面指令，安装依赖，其中包括Propel：
```
$ composer install
```
这时会发现下载速度明显提高了很多，但是还是要提醒读者朋友们，在下载`propel/propel`的时候，是要等比较久的时间的。至此Composer方式安装Propel的方法讲解完毕。

# Git
在项目根目录执行指令：
```
git clone git://github.com/propelorm/Propel2 vendor/propel
```
待下载完成，即可得到Propel。这种方式下载来的Propel是稳定版的，若读者们希望得到最新版的Propel，可到propel目录下执行如下指令来实现：
```
$ cd myproject/vendor/propel
$ git pull
```
这种方式笔者有尝试过，但是发现会出现**下载中断**的现象！

# 压缩包
除了上述两种配置方式，还可以通过下载安装包（压缩包）的方式进行配置。在项目根目录中创建`vendor`文件夹，到该文件夹中执行下载压缩包指令：
```
// 下载压缩包
$ wget http://files.propelorm.org/propel-2.0.0.tar.gz
// 解压压缩包
$ tar zxvf propel-2.0.0.tar.gz
// 将解压后的文件重命名为propel
$ mv propel-2.0.0 propel
```
当然读者们也可以通过在浏览器搜索栏直接输入`http://files.propelorm.org/propel-2.0.0.tar.gz`的方式下载压缩包，然后将压缩包解压到新建的vendor文件夹中。
这种配置方式，笔者也有尝试过，但是发现也会存在**下载中断**或**找不到资源**的问题，所以笔者果断回到第一种方式，虽然它麻烦，但是确是可以完整安装配置Propel的方法！

# 参考链接
https://pkg.phpcomposer.com/
http://propelorm.org/documentation/01-installation.html#via-composer

# 写在最后
笔者作为PHP初学者，写这样一篇文章多少有“关公门前耍大刀”之意，文中有错误的地方，欢迎在文章下方留言批评指正，感谢阅读！